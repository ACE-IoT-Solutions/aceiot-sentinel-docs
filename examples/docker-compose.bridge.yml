# Bridge Network Configuration
#
# This compose file uses a standard bridge network for container-to-container
# communication within Docker/Podman's internal network.
#
# USE CASES:
# - Running Sentinel alongside other containers (databases, APIs, etc.)
# - Development/testing where BACnet external network access is not needed
# - Container orchestration scenarios (Kubernetes, Docker Swarm)
#
# IMPORTANT NOTES:
# - This mode does NOT provide direct access to the external BACnet network
# - BACnet discovery will only work with devices reachable from the container network
# - For external BACnet network access, use macvlan or ipvlan modes instead
#
# USAGE:
# 1. Copy this file: cp docker-compose.bridge.yml docker-compose.yml
# 2. Optionally edit configuration below
# 3. Run: docker-compose up -d

version: '3.8'

networks:
  sentinel-network:
    driver: bridge

services:
  sentinel:
    image: ghcr.io/ace-iot-solutions/aceiot-sentinel:latest
    container_name: aceiot-sentinel
    networks:
      - sentinel-network
    ports:
      # Expose web UI on host
      - "5000:5000"
      # Expose BACnet port (for container-to-container or port-forwarded access)
      - "47808:47808/udp"
    environment:
      # AUTO-DETECTION: Set to "auto" to automatically detect container IP
      # The entrypoint will detect the container's bridge network IP
      BACNET_ADDRESS: auto

      # Optional: Customize BACnet device name and instance
      BACNET_NAME: "Sentinel"
      BACNET_INSTANCE: 708114

      # Optional: VOLTTRON configuration
      VOLTTRON_INSTANCE_NAME: sentinel-edge

      # Optional: Web UI configuration
      WEBAPP_ENABLED: "true"
      WEBAPP_PORT: 5000

      # Optional: Scanning configuration
      SCAN_INTERVAL_SECS: 86400

      # Optional: ACE Config Agent (for cloud integration)
      # ACE_CONFIG_ENABLED: "true"
      # ACE_CONFIG_URL: https://manage.aceiot.cloud
      # ACE_CONFIG_JWT: your-jwt-token
      # ACE_CONFIG_GATEWAY: my-gateway

    volumes:
      # Persist VOLTTRON data
      - volttron-data:/home/volttron/.aceiot-sentinel-volttron

      # Optional: Mount SSL certificates
      # - ./certs:/certs:ro

    restart: unless-stopped

    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # Example: Add other services that can communicate with Sentinel
  # via the bridge network
  #
  # example-api:
  #   image: your-api:latest
  #   networks:
  #     - sentinel-network
  #   environment:
  #     # Reference Sentinel by container name
  #     SENTINEL_URL: http://aceiot-sentinel:5000

volumes:
  volttron-data:
    driver: local
